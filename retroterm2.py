#!/usr/bin/python
#for Python 2.7
'''Retro Terminal Program '''

import Queue
import socket
import string
import telnetlib as tl
from Tkinter import *
import sys

DEBUG = 0

print(sys.version_info)

BBSLIST = [
["local", "localhost", "2323"],
["RetroBBS", "66.172.27.229", "2323"],
["Birdbrain BBS", "birdbrainbbs.ufud.org", "64"]
]

HOST = BBSLIST[0]
HOSTDESC = HOST[0]
HOSTNAME = HOST[1]
HOSTPORT = HOST[2]

#Character Set Bitmap Data
#each element contains the xbmp data for a single 16x16 character
#element is equal to the ASCII value of the character minus 32
CHARDATA = [
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0xfc,0x0f,0xfc,0x0f,0x30,0x03,0x30,0x03,0xfc,0x0f,0xfc,0x0f,0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xf0,0x0f,0xf0,0x0f,0xcc,0x00,0xcc,0x00,0xf0,0x03,0xf0,0x03,0xc0,0x0c,0xc0,0x0c,0xfc,0x03,0xfc,0x03,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x3c,0x00,0x3c,0x00,0x3c,0x0c,0x3c,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x0c,0x0f,0x0c,0x0f,0x00,0x0f,0x00,0x0f,0x00,0x00,0x00,0x00",
"0x30,0x00,0x30,0x00,0xcc,0x00,0xcc,0x00,0xcc,0x00,0xcc,0x00,0x30,0x00,0x30,0x00,0xcc,0x0c,0xcc,0x0c,0x0c,0x03,0x0c,0x03,0xf0,0x0c,0xf0,0x0c,0x00,0x00,0x00,0x00",
"0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0x00,0x03,0x00,0x03,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xcc,0x0c,0xcc,0x0c,0xf0,0x03,0xf0,0x03,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0xcc,0x0c,0xcc,0x0c,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xfc,0x0f,0xfc,0x0f,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0f,0x0c,0x0f,0xcc,0x0c,0xcc,0x0c,0x3c,0x0c,0x3c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xf0,0x00,0xf0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x0c,0x00,0x0c,0xc0,0x03,0xc0,0x03,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x03,0xc0,0x03,0x00,0x0c,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x03,0x00,0x03,0xc0,0x03,0xc0,0x03,0x30,0x03,0x30,0x03,0x0c,0x03,0x0c,0x03,0xfc,0x03,0xfc,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x0c,0x00,0x0c,0x00,0xfc,0x03,0xfc,0x03,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xc0,0x0f,0xc0,0x0f,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x0f,0xf0,0x0f,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xfc,0x00,0xfc,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x00,0x00,0x00,0x00",
"0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0x00,0x03,0x00,0x03,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0x00,0x03,0x00,0x03,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0xcc,0x0c,0xcc,0x0c,0xcc,0x0f,0xcc,0x0f,0xcc,0x03,0xcc,0x03,0x0c,0x00,0x0c,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0x30,0x03,0x30,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x0f,0xfc,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x03,0xfc,0x03,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x03,0xfc,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x03,0xfc,0x03,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x03,0xfc,0x03,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x0f,0xf0,0x0f,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0xf0,0x0f,0xf0,0x0f,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x0f,0xfc,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x03,0x0c,0x03,0xcc,0x00,0xcc,0x00,0x3c,0x00,0x3c,0x00,0xcc,0x00,0xcc,0x00,0x0c,0x03,0x0c,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x3c,0x0f,0x3c,0x0f,0xcc,0x0c,0xcc,0x0c,0xcc,0x0c,0xcc,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x3c,0x0c,0x3c,0x0c,0xcc,0x0c,0xcc,0x0c,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x03,0xfc,0x03,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xcc,0x0c,0xcc,0x0c,0x0c,0x03,0x0c,0x03,0xf0,0x0c,0xf0,0x0c,0x00,0x00,0x00,0x00",
"0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xfc,0x03,0xfc,0x03,0xcc,0x00,0xcc,0x00,0x0c,0x03,0x0c,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x0c,0x00,0xf0,0x03,0xf0,0x03,0x00,0x0c,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x30,0x03,0x30,0x03,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xcc,0x0c,0xcc,0x0c,0xcc,0x0c,0xcc,0x0c,0x3c,0x0f,0x3c,0x0f,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x30,0x03,0x30,0x03,0xc0,0x00,0xc0,0x00,0x30,0x03,0x30,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x30,0x03,0x30,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0xfc,0x0f,0xfc,0x0f,0x00,0x0c,0x00,0x0c,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0xf0,0x0f,0xf0,0x0f,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0xf0,0x0f,0xf0,0x0f,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x0c,0x00,0x0c,0x00,0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0x00,0x03,0x00,0x03,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0xfc,0x03,0xfc,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0xfc,0x03,0xfc,0x03,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0x30,0x03,0x30,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0xf0,0x0c,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0f,0x0c,0x0f,0xf0,0x0c,0xf0,0x0c,0x00,0x00,0x00,0x00",
"0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xcc,0x03,0xcc,0x03,0x3c,0x0c,0x3c,0x0c,0x0c,0x0c,0x0c,0x0c,0x3c,0x0c,0x3c,0x0c,0xcc,0x03,0xcc,0x03,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x0f,0xc0,0x0f,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x30,0x00,0xc0,0x0f,0xc0,0x0f,0x00,0x00,0x00,0x00",
"0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0xf0,0x0c,0xf0,0x0c,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0f,0x0c,0x0f,0xf0,0x0c,0xf0,0x0c,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0xfc,0x0f,0xfc,0x0f,0x0c,0x00,0x0c,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0xf0,0x0c,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0xf0,0x0f,0xf0,0x0f,0x00,0x0c,0x00,0x0c,0xf0,0x03,0xf0,0x03",
"0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0xf0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x03,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0xf0,0x00,0xf0,0x00",
"0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x03,0x0c,0x03,0xcc,0x00,0xcc,0x00,0xfc,0x00,0xfc,0x00,0x0c,0x03,0x0c,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0xf0,0x00,0xf0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0x0f,0x3c,0x0f,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfc,0x03,0xfc,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x03,0xf0,0x03,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x03,0xf0,0x03,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcc,0x03,0xcc,0x03,0x3c,0x0c,0x3c,0x0c,0x0c,0x0c,0x0c,0x0c,0x3c,0x0c,0x3c,0x0c,0xcc,0x03,0xcc,0x03,0x0c,0x00,0x0c,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0xf0,0x0c,0x0c,0x0f,0x0c,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0x0f,0x0c,0x0f,0xf0,0x0c,0xf0,0x0c,0x00,0x3c,0x00,0x3c",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcc,0x03,0xcc,0x03,0x3c,0x00,0x3c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0f,0xf0,0x0f,0x0c,0x00,0x0c,0x00,0xf0,0x03,0xf0,0x03,0x00,0x0c,0x00,0x0c,0xfc,0x03,0xfc,0x03,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xfc,0x0f,0xfc,0x0f,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0xf0,0x0f,0xf0,0x0f,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0xcc,0x30,0x30,0x0f,0x30,0x0f,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c,0x0c,0x0c,0x30,0x03,0x30,0x03,0xc0,0x00,0xc0,0x00,0x30,0x03,0x30,0x03,0x0c,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x0c,0x30,0x0c,0x30,0x0c,0x30,0x0c,0x30,0x0c,0x30,0x0c,0xf0,0x0f,0xf0,0x0f,0x00,0x0c,0x00,0x0c,0xf0,0x03,0xf0,0x03",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0xfc,0x0f,0xfc,0x0f,0x00,0x00,0x00,0x00",
"0x00,0x0f,0x00,0x0f,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x30,0x00,0x30,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x0f,0x00,0x0f,0x00,0x00,0x00,0x00",
"0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00",
"0x3c,0x00,0x3c,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x00,0x03,0x00,0x03,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0x3c,0x00,0x3c,0x00,0x00,0x00,0x00,0x00",
"0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x0c,0xf0,0x03,0xf0,0x03,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00",
"0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff",
]

#XBM Data Template
XHEAD = "#define im_width 16\n#define im_height 16\nstatic char im_bits[] = {\n"
XTAIL = "\n};\n"


#Constants
BACKGROUND = 'Lime Green'
FOREGROUND = 'Black'
VDT_COLUMNS = 32
VDT_ROWS = 24
VDT_TABSTOP = 8

class Character(Canvas):
  '''Character cell: displays of a single character'''
  def __init__(self, master, **args):
    Canvas.__init__(self, master, **args)
    self.config(background=BACKGROUND, highlightthickness=0)
    self.__bitmap = None
  def __drawBitmap(self):
    #draw current bitmap onto instance
    if self.__bitmap:
      self.create_image(8, 8, image=self.__bitmap)
  def drawBitmap(self, bitmap):
    '''Set and draw the specified bitmap on instance.
       If bitmap=None, current bitmap is removed from cell and undrawn'''
    self.__bitmap = bitmap
    self.delete(ALL)
    self.__drawBitmap()
  def setCursor(self, state):
    '''Set cursor state.
       If state=True, cursor is drawn on cell
       If state=False, current bitmap is drawn on cell'''
    self.delete(ALL)
    if state:
      self.create_rectangle(0,0,16,16, fill=FOREGROUND)
    else:
      self.__drawBitmap()
  def getBitmap(self):
    '''Return bitmap currently assigned to cell'''
    return self.__bitmap
    
class VDT(Frame):
  def __leftClick(self, event):
    self.focus()
  def __buildchar(self, chardata):
    #builds XBMP string from character pixel data
    char = XHEAD + chardata + XTAIL
    return char
  def __buildcharset(self):
    #Builds a dictionary of bitmaps from list CHARDATA
    #Dictionary key is ASCII character code
    charset = dict()
    i = 0
    while i < len(CHARDATA):
      xbm = self.__buildchar(CHARDATA[i])
      bitmap = BitmapImage(data=xbm, foreground=FOREGROUND)
      charset[i+32] = bitmap
      i += 1
    return charset
  def __builddisplay(self):
    #Builds a grid of Characters VDT_COLUMNS wide by VDT_COLUMNS high
    size = 8 * self.__scale
    display = dict()
    row = 0
    while row < VDT_ROWS:
      column = 0
      while column < VDT_COLUMNS:
        canvas = Character(self, width=size, height=size)
        canvas.grid(row=row, column=column)
        canvas.bind("<1>", self.__leftClick)
        display[row*VDT_COLUMNS+column] = canvas
        column += 1
      row += 1
    return display
  def homeCursor(self):
    '''Move cursor to home position: row 0, column 0'''
    self.__row = 0
    self.__column = 0        
  def __init__(self, master, scale=2):
    Frame.__init__(self, master)
    self.config(background=BACKGROUND)
    self.__scale = scale
    self.__charset = self.__buildcharset()
    self.__display = self.__builddisplay()
    self.__lastChar = None
    self.homeCursor()
  def clearScreen(self):
    '''Clear screen and move cursor to home position'''
    for i in self.__display:
      self.__display[i].drawBitmap(None)
    self.homeCursor()
  def __getCanvas(self):
    #returns canvas at current row and column
    i = self.__row * VDT_COLUMNS + self.__column
    return self.__display[i]
  def drawChar(self, char):
    '''Draw ASCII character char at current row and column'''
    c = 0 if char==None else ord(char)
    canvas = self.__getCanvas()
    if 32 <= c <= 127:
      bitmap = self.__charset[c]
    else:
      bitmap = None
    canvas.drawBitmap(bitmap)
  def setCursor(self, state):
    '''Set cursor state.
       If state = True, turn cursor on
       If state = False, turn cursor off'''
    self.__getCanvas().setCursor(state)
  def scrollUp(self):
    '''Scroll screen up one line.'''
    display = self.__display
    displen = len(display)
    i = 0
    for i in range(0,displen):
      j = i + VDT_COLUMNS
      if j < displen:
        bitmap = display[j].getBitmap()
      else:
        bitmap = None
      display[i].drawBitmap(bitmap)
  def firstColumn(self):
    '''Move cursor to leftmost column of current row.'''
    self.__column = 0
  def lastColumn(self):
    '''Move cursor to rightmost column of current row.'''
    self.__column = VDT_COLUMNS - 1
  def backSpace(self):
    '''Move cursor to left and delete character in new position.'''
    if self.__column:
      self.__column -= 1
    elif self.__row:
      self.__row -= 1
      self.lastColumn()
    self.drawChar(None)
  def nextRow(self):
    '''Move cursor to down one row, staying on same column.'''
    if self.__row < VDT_ROWS-1:
      self.__row += 1
    else:
      self.scrollUp()
  def newLine(self):
    '''Move cursor to the leftmost column of the row below the current row.'''
    self.nextRow()
    self.firstColumn()
  def nextColumn(self, columns=1):
    '''Move cursor one column to the right, wrapping to next line if needed.'''
    self.__column += columns
    if self.__column >= VDT_COLUMNS:
      self.newLine()
  def nextTab(self):
    '''Move cursor right to next tab stop, wrapping to next line if needed.'''
    offset = self.__column % VDT_TABSTOP
    columns = VDT_TABSTOP - offset
    self.nextColumn(columns)
  def printChar(self, char):
    '''Print ASCII character char.
       If char is printable,  draw and move cursor to right.
       If char is control chacter, perform associated action.
         Hex Char Action
          07 BEL  Beep (may not work)
          08 BS   execute self.Backspace()
          09 TAB  execute self.nextTab()
          0A LF   execute self.newLine() if last character was not CR
          0C FF   execute self.clearScreen()
          0D CR   execute self.newLine()
       Otherwise, do nothing.'''
    i = ord(char)
    if ' ' <= char < '\x7f':
      self.drawChar(char)
      self.nextColumn()
    elif i == 0x07:  #BEL
      self.bell()
    elif i == 0x08:  #BS
      self.backSpace()
    elif i == 0x09:  #TAB
      self.nextTab()
    elif i == 0x0A:  #LF
      if self.__column: 
        self.newLine()
    elif i == 0x0C:  #FF
      self.clearScreen()
    elif i == 0x0D: #CR
      self.newLine()
    elif i == 0x11: #DC1
      pass #start data capture
    elif i == 0x13: #DC3
      pass #end data capture
    self.__lastChar = char

class Modem(object):
  def __sendraw(self, skt, data):
    self.__telnet.msg("send %r", data)
    skt.sendall(data)
  def __negotiate_option(self, skt, cmd, opt):
    #override default negotiations
    if cmd == tl.DO:
      rsp = tl.IAC + tl.WONT + opt
    elif cmd == tl.DONT:
      rsp = tl.IAC + tl.WONT + opt
    elif cmd == tl.WILL:
      rsp = tl.IAC + tl.DO + opt
    elif cmd == tl.WONT:
      rsp = tl.IAC + tl.DONT + opt
    else:
      rsp = None
    if rsp: self.__sendraw(skt, rsp)
  def __init__(self, incharfn, afterfn, disconnectfn):
    object.__init__(self)
    self.inchar_callback = incharfn
    self.after_callback = afterfn
    self.disconnect_callback = disconnectfn
    self.outbuffer = Queue.Queue()
    self.inbuffer = Queue.Queue()
    self.__telnet = tl.Telnet()
    self.__telnet.set_option_negotiation_callback(self.__negotiate_option)
    self.__telnet.set_debuglevel(DEBUG)
    self.__delay = 33  #33 Millisecons is about 300bps
    self.connected = False
  def __clear_inbuffer(self):
    while not self.inbuffer.empty():
      self.inbuffer.get()
  def __echo(self, data):
    self.inbuffer.put('\n')
    for char in data:
      self.inbuffer.put(char)
    self.inbuffer.put('\r')
  def __read(self):
    try:
      data = self.__telnet.read_very_eager()
    except Exception as x:
      self.connected = False
      data = x.message + "\r"
    return data
  def __write(self, data):
    try:
      self.__telnet.write(data)
    except Exception as x:
      self.connected = False
  def __timer(self):
    #Handle Modem Input and Output
    #executed every self._delay milliseconds to simulate desired bps rate
    if self.connected:
      data = self.__read()          #copy incoming data from modem
      for char in data:             #to input buffer
        self.inbuffer.put(char)     #as separate characters
      if not self.outbuffer.empty():
        char = self.outbuffer.get()  #copy one character from output buffer
        self.__write(char)        #to modem
    else:
      self.disconnect_callback()
    if not self.inbuffer.empty():
      char = self.inbuffer.get()
      self.inchar_callback(char)
    if self.connected or not self.inbuffer.empty():
      self.after_callback(self.__delay, self.__timer)
  def connect(self, host, port=23):
    '''Connect via telnet protocol to host using port'''
    try:
      portno = int(port)
      if portno<0 or portno>65535: raise ValueError()
      self.__telnet.open(host, portno, 1)
      self.connected = True
      result = "Connected"
    except socket.timeout as e:      
      result = e[0]
    except socket.error as e:
      errno, errmsg = e
      result = errmsg
    except ValueError as x:
      result = "Invalid Port"
    except Exception as x:
      result = x.message
    self.__echo(result)
    self.__timer()
  def disconnect(self):
    self.__telnet.close()
    self.connected = False
    self.__echo("Disconnected")
  def outchar(self, char):
    '''Send character to modem'''
    if char and self.connected: 
      #if Ctrl-C and receiving data, stop receiving and exit
      if char == '\x03' and not self.inbuffer.empty():
        self.__clear_inbuffer()
        return
      self.outbuffer.put(char)

class UI(Frame):
  def __init__(self, master, enterFn, buttonFn):
    Frame.__init__(self, master)
    self.hostlabel = Label(self, text=" Host ")
    self.hostlabel.grid(row=0, column=0, sticky=E)
    self.hostname = Entry(self, width=28)
    self.hostname.grid(row=0, column=1)
    self.hostname.bind('<Key-Return>', enterFn)
    self.portlabel = Label(self, text=" Port ")
    self.portlabel.grid(row=0, column=2, sticky=E)
    self.portno = Entry(self, width=5)
    self.portno.grid(row=0, column=3)
    self.portno.bind('<Key-Return>', enterFn)
    self.button = Button(self, width=8)
    self.button.grid(row=0, column=6, sticky=E+W)
    self.button.config(command=buttonFn) 
  def focus(self):
    Frame.focus(self)
    self.hostname.focus()
  def getHostName(self):
    return self.hostname.get()
  def getPortNo(self):
    return self.portno.get()
  def setButtonText(self, connected):
    text = "Disconnect" if connected else "Connect"
    self.button.config(text=text)
  def setHostName(self, host):
    self.hostname.delete(0,END)
    self.hostname.insert(0,host)
  def setPortNo(self, portno):
    self.portno.delete(0,END)
    self.portno.insert(0,portno)
    
class Term(Tk):
  def __input(self, s):
    #write string to VDT
    for char in s:
      self.vdt.printChar(char)
  def __output(self, s):
    #write string to modem
    for char in s:
      self.modem.outchar(char)
  def __keypress(self, event):
    #handle keypress from terminal
    self.modem.outchar(event.char)
    return('break')
  def __setUIConnected(self):
    #Set UI conection state to Modem connection state
    self.ui.setButtonText(self.modem.connected)
  def __disconnected(self):
    #handle disconnection
    self.__setUIConnected()
    self.ui.focus()
  def __inChar(self, char):
    #Called by Modem instance each time a character is received
    if char == '\x05':
      #issue Answerback on receipt of ^E
      self.__output("RETROTERM\r\n")
    else:
      #print character to terminal screen
      self.vdt.setCursor(False)
      self.vdt.printChar(char)
      self.vdt.setCursor(True)
  def __connect(self):
    #connect to host
    host = self.ui.getHostName()
    portno = self.ui.getPortNo()
    self.modem.connect(host, portno)
    if self.modem.connected:
      self.__setUIConnected()
    self.vdt.focus()
    self.vdt.setCursor(True)
  def __disconnect(self):
    #disconnect from host
    self.modem.disconnect() 
    self.__disconnected()
  def __uiButton(self):
    #handle Connect/Disconnect Button Click
    if self.modem.connected:
      self.__disconnect()
    else:
      self.__connect()
  def __uiDefault(self, event=None):
    #handle Enter Key from Host and Port Entries
    if not self.modem.connected:
      self.__connect()
  def __vdtFocused(self, event=None):
    if not self.modem.connected:
      self.ui.focus()
  def __init__(self):
    Tk.__init__(self)
    self.echo = IntVar()
    self.title("RetroTerm")
    self.modem = Modem(self.__inChar, self.after, self.__disconnected)
    self.ui = UI(self, self.__uiDefault, self.__uiButton)
    self.ui.pack()
    self.__setUIConnected()
    self.vdt = VDT(self)
    self.vdt.pack()
    self.vdt.bind('<Key>', self.__keypress)
    self.vdt.bind('<FocusIn>', self.__vdtFocused)
    self.ui.setHostName(HOSTNAME)
    self.ui.setPortNo(HOSTPORT)
    self.ui.focus()
term = Term()
term.mainloop()

